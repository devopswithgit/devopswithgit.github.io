<!DOCTYPE html>
<html>
    <head>
        <title>Accman Refresh : Testing of Migrated Scripts</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Accman Refresh</a></span>
                            </li>
                                                    <li>
                                <span><a href="Accman-Refresh-Home_17170433.html">Accman Refresh Home</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Accman Refresh : Testing of Migrated Scripts
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Unknown User (uis612)</span>, last modified on Dec 17, 2014
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="TestingofMigratedScripts-Overview">Overview</h1><p>This page details the testing approach required by each of the migrated scripts that have been converted from Perl to C# / .NET.</p><h1 id="TestingofMigratedScripts-Scheduled\SISImportScripts">Scheduled \ SIS Import Scripts</h1><p>These are scripts that communicate with the Banner student information system (SIS). Due to the extensive narrative required, each script is described in a separate section, rather than presenting all of them in a table.</p><h2 id="TestingofMigratedScripts-Banner4Address">Banner4Address</h2><h3 id="TestingofMigratedScripts-Overview.1">Overview</h3><p>The class <code>Banner4Address</code> is based on the Perl script <code>banner4address.pl</code>. The latter performs the following steps:</p><ol><li>Clears down AccMan table <code>banner_address</code>.</li><li>Populates AccMan table <code>banner_address</code> with the data set from a pre-defined Oracle query that selects data from the <code>SPRIDEN</code>, <code>SPRADDR</code> and <code>SGBSTDN</code> tables. Note that the records thus selected are filtered to those where the address type (<code>SPRADDR_ATYP_CODE</code>) is either 'PR' or 'TT' and where the 'active' period of the <code>SPRADDR</code> record, as determined by <code>SPRADDR_FROM_DATE</code> and <code>SPRADDR_TO_DATE</code>, bounds the current date and time. In addition, the effective term of the <code>SGBSTDN</code> record (<code>SGBSTDN_TERM_CODE_EFF</code>) will be restricted to those in the current year (i.e. first four digits of the term) or later. The year component of 'current' term is equal to the current calendar year, if the current month is less than 7, or the next calendar year otherwise. Thus, on 17th September 2014, for example, the year component of the 'current' term will be '2015'.</li></ol><h3 id="TestingofMigratedScripts-DeterminingBehaviourofPerlScript">Determining Behaviour of Perl Script</h3><p>In order to test the C# class <code>Banner4Address</code>, it will first be necessary to determine the behaviour of the existing Perl script. This will require:</p><ol><li>A test AccMan database, although only the contents of the <code>banner_address</code> table are impacted. The current AccMan test database, <code>MAIL</code> on <code>UOS-T-RHEL-03</code>, might be appropriate for this test, as only the address import table is impacted.</li><li>A test Banner database. The contents of the above Banner tables will need to remain stable between the testing of the Perl script and C# class. It would probably be appropriate to use <code>DBANO1</code>, as the data held in Banner does not need to be synchronised with any other system. If this is an issue, due to firewall access issues preventing connections between 'test' and 'development' environments, it might be possible to use either <code>UBANO1</code> (Banner test) or <code>TBANFO</code> (Banner 'prod-fix').</li></ol><p>The behaviour of the Perl script can then be determined by:</p><ol><li>Running the script against the test databases.</li><li>Copying the final content of the AccMan <code>banner_address</code> table to a temporary, working table. This could,perhaps, be named <code>banner_address_perl</code>. This can be achieved with the following SQL statement:</li></ol><p><code>  CREATE TABLE banner_address_perl</code><br/><code>  AS</code><br/><code>  SELECT *</code><br/><code>    FROM banner_address ;</code></p><h3 id="TestingofMigratedScripts-DetermingBehaviourof.NETClass">Determing Behaviour of .NET Class</h3><p>Once the data extract by the Perl script is safely cached in <code>banner_address_perl</code>, the .NET class needs to be invoked against the same databases. This is currently performed in the Visual Studio environment by executing the <code>ConsoleSchedulerService</code> project and entering the following on the console that appears:</p><p><code>  e:1501</code></p><p>The output from the above will now be populated into the AccMan <code>banner_address</code> table.</p><h3 id="TestingofMigratedScripts-ComparingBehaviourofPerlScriptand.NETClass">Comparing Behaviour of Perl Script and .NET Class</h3><p>The output from each of the above should now be compared for equality.</p><h4 id="TestingofMigratedScripts-Test#1-Determiningallrowsextractedby.NETclassscriptarealsoextractedbyPerlscript">Test #1 - Determining all rows extracted by .NET class script are also extracted by Perl script</h4><p>The following query should result in no rows being returned when run on the target AccMan database:</p><p><code>SELECT *</code><br/><code>  FROM mail.banner_address ba</code><br/><code> WHERE NOT EXISTS (SELECT 1</code><br/><code>                     FROM mail.banner_address_perl bap</code><br/><code>                    WHERE bap.spriden_pidm = ba.spriden_pidm</code><br/><code>                      AND bap.spriden_id = ba.spriden_id</code><br/><code>                      AND bap.spraddr_atyp_code = ba.spraddr_atyp_code</code><br/><code>                      AND (bap.spraddr_street_line1 = ba.spraddr_street_line1</code><br/><code>                          OR (bap.spraddr_street_line1 IS NULL AND ba.spraddr_street_line1 IS NULL))</code><br/><code>                      AND (bap.spraddr_street_line2 = ba.spraddr_street_line2</code><br/><code>                          OR (bap.spraddr_street_line2 IS NULL AND ba.spraddr_street_line2 IS NULL))</code><br/><code>                      AND (bap.spraddr_street_line3 = ba.spraddr_street_line3</code><br/><code>                          OR (bap.spraddr_street_line3 IS NULL AND ba.spraddr_street_line3 IS NULL))</code><br/><code>                      AND bap.spraddr_city = ba.spraddr_city</code><br/><code>                      AND (bap.spraddr_zip = ba.spraddr_zip</code><br/><code>                          OR (bap.spraddr_zip IS NULL AND ba.spraddr_zip IS NULL))) ;</code></p><p>The above query identifies any records that have been extracted by the .NET class that have <u>not</u> also been extracted by the Perl script.</p><h4 id="TestingofMigratedScripts-Test#2-DeterminingallrowsextractedbyPerlscriptarealsoextractedby.NETclass">Test #2 - Determining all rows extracted by Perl script are also extracted by .NET class</h4><p>The following query should result in no rows being returned when run on the target AccMan database:</p><p><code>SELECT *</code><br/><code>  FROM mail.banner_address_perl bap</code><br/><code> WHERE NOT EXISTS (SELECT 1</code><br/><code>                     FROM mail.banner_address ba</code><br/><code>                    WHERE ba.spriden_pidm = bap.spriden_pidm</code><br/><code>                      AND ba.spriden_id = bap.spriden_id</code><br/><code>                      AND ba.spraddr_atyp_code = bap.spraddr_atyp_code</code><br/><code>                      AND (ba.spraddr_street_line1 = bap.spraddr_street_line1</code><br/><code>                          OR (ba.spraddr_street_line1 IS NULL AND bap.spraddr_street_line1 IS NULL))</code><br/><code>                      AND (ba.spraddr_street_line2 = bap.spraddr_street_line2</code><br/><code>                          OR (ba.spraddr_street_line2 IS NULL AND bap.spraddr_street_line2 IS NULL))</code><br/><code>                      AND (ba.spraddr_street_line3 = bap.spraddr_street_line3</code><br/><code>                          OR (ba.spraddr_street_line3 IS NULL AND bap.spraddr_street_line3 IS NULL))</code><br/><code>                      AND ba.spraddr_city = bap.spraddr_city</code><br/><code>                      AND (ba.spraddr_zip = bap.spraddr_zip</code><br/><code>                          OR (ba.spraddr_zip IS NULL AND bap.spraddr_zip IS NULL))) ;</code></p><p>(n.b. This is the logical 'inverse' of the previous query).</p><h3 id="TestingofMigratedScripts-Summary">Summary</h3><p>Testing of the <code>Banner4Address</code> class comprises determining that the <code>banner_address</code> table is populated with exactly them same data as that loaded by the <code>banner4address.pl</code> script.</p><h2 id="TestingofMigratedScripts-Banner4Prog">Banner4Prog</h2><h3 id="TestingofMigratedScripts-Overview.2">Overview</h3><p>The class <code>Banner4Prog</code> is based on the Perl script <code>banner4prog.pl</code>. The latter performs the following steps:</p><ol><li>Clears down AccMan table <code>prog</code>.</li><li>Populates AccMan table <code>prog</code> with the data set from a pre-defined Oracle query that selects data from the <code>SMRPRLE</code> and <code>SKRPMOD</code> tables. The only filtering that occurs is to restrict the records returned to those where <code>SMRPRLE_CURR_RULE_IND</code> is 'Y'.</li></ol><h3 id="TestingofMigratedScripts-DeterminingBehaviourofPerlScript.1">Determining Behaviour of Perl Script</h3><p>In order to test the C# class <code>Banner4Prog</code>, it will first be necessary to determine the behaviour of the existing Perl script. This will require:</p><ol><li>A test AccMan database, although only the contents of the <code>prog</code> table are impacted. The current AccMan test database, <code>MAIL</code> on <code>UOS-T-RHEL-03</code>, might be appropriate for this test, as only the programme import table is impacted.</li><li>A test Banner database. The contents of the above Banner tables will need to remain stable between the testing of the Perl script and C# class. It would probably be appropriate to use <code>DBANO1</code>, as the data held in Banner does not need to be synchronised with any other system. If this is an issue, due to firewall access issues preventing connections between 'test' and 'development' environments, it might be possible to use either <code>UBANO1</code> (Banner test) or <code>TBANFO</code> (Banner 'prod-fix').</li></ol><p>The behaviour of the Perl script can then be determined by:</p><ol><li>Running the script against the test databases.</li><li>Copying the final content of the AccMan <code>prog</code> table to a temporary, working table. This could,perhaps, be named <code>prog_perl</code>. This can be achieved with the following SQL statement:</li></ol><p><code>  CREATE TABLE prog_perl</code><br/><code>  AS</code><br/><code>  SELECT *</code><br/><code>    FROM prog ;</code></p><h3 id="TestingofMigratedScripts-DetermingBehaviourof.NETClass.1">Determing Behaviour of .NET Class</h3><p>Once the data extract by the Perl script is safely cached in <code>prog_perl</code>, the .NET class needs to be invoked against the same databases. This is currently performed in the Visual Studio environment by executing the <code>ConsoleSchedulerService</code> project and entering the following on the console that appears:</p><p><code>  e:1505</code></p><p>The output from the above will now be populated into the AccMan <code>prog</code> table.</p><h3 id="TestingofMigratedScripts-ComparingBehaviourofPerlScriptand.NETClass.1">Comparing Behaviour of Perl Script and .NET Class</h3><p>The output from each of the above should now be compared for equality.</p><h4 id="TestingofMigratedScripts-Test#1-Determiningallrowsextractedby.NETclassscriptarealsoextractedbyPerlscript.1">Test #1 - Determining all rows extracted by .NET class script are also extracted by Perl script</h4><p>The following query should result in no rows being returned when run on the target AccMan database:</p><p><code>SELECT *</code><br/><code>  FROM mail.prog pg</code><br/><code> WHERE NOT EXISTS (SELECT 1</code><br/><code>                     FROM mail.prog_perl pgp</code><br/><code>                    WHERE pgp.program = pg.program</code><br/><code>                      AND pgp.program_desc = pg.program_desc</code><br/><code>                      AND (pgp.splength = pg.splength</code><br/><code>                          OR (pgp.splength IS NULL AND pg.splength IS NULL))</code><br/><code>                      AND (pgp.uoms = pg.uoms</code><br/><code>                          OR (pgp.uoms IS NULL AND pg.uoms IS NULL))) ;</code></p><p>The above query identifies any records that have been extracted by the .NET class that have <u>not</u> also been extracted by the Perl script.</p><h4 id="TestingofMigratedScripts-Test#2-DeterminingallrowsextractedbyPerlscriptarealsoextractedby.NETclass.1">Test #2 - Determining all rows extracted by Perl script are also extracted by .NET class</h4><p>The following query should result in no rows being returned when run on the target AccMan database:</p><p><code>SELECT *</code><br/><code>  FROM mail.prog_perl pgp</code><br/><code> WHERE NOT EXISTS (SELECT 1</code><br/><code>                     FROM mail.prog pg</code><br/><code>                    WHERE pg.program = pgp.program</code><br/><code>                      AND pg.program_desc = pgp.program_desc</code><br/><code>                      AND (pg.splength = pgp.splength</code><br/><code>                          OR (pg.splength IS NULL AND pgp.splength IS NULL))</code><br/><code>                      AND (pg.uoms = pgp.uoms</code><br/><code>                          OR (pg.uoms IS NULL AND pgp.uoms IS NULL))) ;</code></p><p>(n.b. This is the logical 'inverse' of the previous query).</p><h3 id="TestingofMigratedScripts-Summary.1">Summary</h3><p>Testing of the <code>Banner4Prog</code> class comprises determining that the <code>prog</code> table is populated with exactly them same data as that loaded by the <code>banner4prog.pl</code> script.</p><h2 id="TestingofMigratedScripts-Banner4Import">Banner4Import</h2><h3 id="TestingofMigratedScripts-Overview.3">Overview</h3><p>The class <code>Banner4Import</code> is based on the Perl script <code>banner4import.pl</code>. The latter performs the following steps:</p><ol><li>Clears down AccMan table <code>banner_import</code>.</li><li>Populates AccMan table <code>banner_import</code> with the data set from a pre-defined Oracle query that selects data from the <code>SPRIDEN</code>, <code>SPBPERS</code>, <code>SGBSTDN</code>, <code>SFBETRM</code> and <code>SKBHINS</code>  tables. In addition, a join is made to the view <code>V_SAL_SHRDGMR_MAX_SEQ_NO</code>, which serves to select the <code>SHRDGMR</code> record with the highest sequence number for each combination of student and programme. The filtering applied to the query is summarised as restricting to the <code>SFBETRM</code> record where <code>SFBETRM_TERM_CODE</code> is the latest for the particular student where <code>SFBETRM_ESTS_CODE</code> is <u style="line-height: 1.4285715;">not</u> 'EL' (i.e. the latest registration record with a status other than 'eligible') and the term is within the current academic year. As discussed previously, this will be the calendar year where the current month is less than seven, or the next year if it is equal to or greater.</li></ol><h3 id="TestingofMigratedScripts-DeterminingBehaviourofPerlScript.2">Determining Behaviour of Perl Script</h3><p>In order to test the C# class <code>Banner4Import</code>, it will first be necessary to determine the behaviour of the existing Perl script. This will require:</p><ol><li>A test AccMan database, although only the contents of the <code>banner_import</code> table are impacted. The current AccMan test database, <code>MAIL</code> on <code>UOS-T-RHEL-03</code>, might be appropriate for this test, as only the particular import table is impacted.</li><li>A test Banner database. The contents of the above Banner tables will need to remain stable between the testing of the Perl script and C# class. It would probably be appropriate to use <code>DBANO1</code>, as the data held in Banner does not need to be synchronised with any other system. If this is an issue, due to firewall access issues preventing connections between 'test' and 'development' environments, it might be possible to use either <code>UBANO1</code> (Banner test) or <code>TBANFO</code> (Banner 'prod-fix').</li></ol><p>The behaviour of the Perl script can then be determined by:</p><ol><li>Running the script against the test databases.</li><li>Copying the final content of the AccMan <code>banner_import</code> table to a temporary, working table. This could,perhaps, be named <code>banner_import_perl</code>. This can be achieved with the following SQL statement:</li></ol><p><code>  CREATE TABLE banner_import_perl</code><br/><code>  AS</code><br/><code>  SELECT *</code><br/><code>    FROM banner_import ;</code></p><h3 id="TestingofMigratedScripts-DetermingBehaviourof.NETClass.2">Determing Behaviour of .NET Class</h3><p>Once the data extract by the Perl script is safely cached in <code>banner_import_perl</code>, the .NET class needs to be invoked against the same databases. This is currently performed in the Visual Studio environment by executing the <code>ConsoleSchedulerService</code> project and entering the following on the console that appears:</p><p><code>  e:1503</code></p><p>The output from the above will now be populated into the AccMan <code>banner_import</code> table.</p><h3 id="TestingofMigratedScripts-ComparingBehaviourofPerlScriptand.NETClass.2">Comparing Behaviour of Perl Script and .NET Class</h3><p>The output from each of the above should now be compared for equality.</p><h4 id="TestingofMigratedScripts-Test#1-Determiningallrowsextractedby.NETclassscriptarealsoextractedbyPerlscript.2">Test #1 - Determining all rows extracted by .NET class script are also extracted by Perl script</h4><p>The following query should result in no rows being returned when run on the target AccMan database:</p><p><code>SELECT *</code><br/><code>  FROM banner_import bi</code><br/><code> WHERE NOT EXISTS (SELECT 1</code><br/><code>                     FROM banner_import_perl bip</code><br/><code>                    WHERE bip.spriden_pidm = bi.spriden_pidm</code><br/><code>                      AND bip.spriden_id = bi.spriden_id</code><br/><code> <span>                      </span>AND bip.spriden_last_name = bi.spriden_last_name</code><br/><code> <span>                      </span>AND bip.spriden_first_name = bi.spriden_first_name</code><br/><code> <span>                      </span>AND (bip.spriden_mi = bi.spriden_mi</code><br/><code> <span>                          </span>OR (bip.spriden_mi IS NULL AND bi.spriden_mi IS NULL))</code><br/><code> <span>                      </span>AND bip.spbpers_birth_date = bi.spbpers_birth_date</code><br/><code> <span>                      </span>AND bip.spbpers_sex = bi.spbpers_sex</code><br/><code> <span>                      </span>AND bip.spbpers_name_prefix = bi.spbpers_name_prefix</code><br/><code> <span>                      </span>AND bip.sgbstdn_term_code_eff = bi.sgbstdn_term_code_eff</code><br/><code> <span>                      </span>AND bip.sgbstdn_stst_code = bi.sgbstdn_stst_code</code><br/><code> <span>                      </span>AND bip.sgbstdn_levl_code = bi.sgbstdn_levl_code</code><br/><code> <span>                      </span>AND bip.sgbstdn_styp_code = bi.sgbstdn_styp_code</code><br/><code> <span>                      </span>AND bip.sgbstdn_degc_code_1 = bi.sgbstdn_degc_code_1</code><br/><code> <span>                      </span>AND bip.sgbstdn_majr_code_1 = bi.sgbstdn_majr_code_1</code><br/><code> <span>                      </span>AND bip.sgbstdn_blck_code = bi.sgbstdn_blck_code</code><br/><code> <span>                      </span>AND bip.sgbstdn_dept_code = bi.sgbstdn_dept_code</code><br/><code> <span>                      </span>AND bip.sgbstdn_program_1 = bi.sgbstdn_program_1</code><br/><code> <span>                      </span>AND bip.sfbetrm_ar_ind = bi.sfbetrm_ar_ind</code><br/><code> <span>                      </span>AND bip.sfbetrm_add_date = bi.sfbetrm_add_date</code><br/><code> <span>                      </span>AND bip.sfbetrm_ests_code = bi.sfbetrm_ests_code</code><br/><code> <span>                      </span>AND (bip.skbhins_enddate = bi.skbhins_enddate</code><br/><code> <span>                          </span>OR (bip.skbhins_enddate IS NULL AND bi.skbhins_enddate IS NULL))</code><br/><code> <span>                      </span>AND bip.shrdgmr_degs_code = bi.shrdgmr_degs_code</code><br/><code> <span>                      </span>AND (bip.shrdgmr_grad_date = bi.shrdgmr_grad_date</code><br/><code> <span>                          </span>OR (bip.shrdgmr_grad_date IS NULL AND bi.shrdgmr_grad_date IS NULL))) ;</code></p><p>The above query identifies any records that have been extracted by the .NET class that have <u>not</u> also been extracted by the Perl script.</p><h4 id="TestingofMigratedScripts-Test#2-DeterminingallrowsextractedbyPerlscriptarealsoextractedby.NETclass.2">Test #2 - Determining all rows extracted by Perl script are also extracted by .NET class</h4><p>The following query should result in no rows being returned when run on the target AccMan database:</p><p><code>SELECT *</code><br/><code>  FROM banner_import_perl bip</code><br/><code> WHERE NOT EXISTS (SELECT 1</code><br/><code>                     FROM banner_import bi</code><br/><code>                    WHERE bi.spriden_pidm = bip.spriden_pidm</code><br/><code>                      AND bi.spriden_id = bip.spriden_id</code><br/><code> <span>                      </span>AND bi.spriden_last_name = bip.spriden_last_name</code><br/><code> <span>                      </span>AND bi.spriden_first_name = bip.spriden_first_name</code><br/><code> <span>                      </span>AND (bi.spriden_mi = bip.spriden_mi</code><br/><code> <span>                          </span>OR (bi.spriden_mi IS NULL AND bip.spriden_mi IS NULL))</code><br/><code> <span>                      </span>AND bi.spbpers_birth_date = bip.spbpers_birth_date</code><br/><code> <span>                      </span>AND bi.spbpers_sex = bip.spbpers_sex</code><br/><code> <span>                      </span>AND bi.spbpers_name_prefix = bip.spbpers_name_prefix</code><br/><code> <span>                      </span>AND bi.sgbstdn_term_code_eff = bip.sgbstdn_term_code_eff</code><br/><code> <span>                      </span>AND bi.sgbstdn_stst_code = bip.sgbstdn_stst_code</code><br/><code> <span>                      </span>AND bi.sgbstdn_levl_code = bip.sgbstdn_levl_code</code><br/><code> <span>                      </span>AND bi.sgbstdn_styp_code = bip.sgbstdn_styp_code</code><br/><code> <span>                      </span>AND bi.sgbstdn_degc_code_1 = bip.sgbstdn_degc_code_1</code><br/><code> <span>                      </span>AND bi.sgbstdn_majr_code_1 = bip.sgbstdn_majr_code_1</code><br/><code> <span>                      </span>AND bi.sgbstdn_blck_code = bip.sgbstdn_blck_code</code><br/><code> <span>                      </span>AND bi.sgbstdn_dept_code = bip.sgbstdn_dept_code</code><br/><code> <span>                      </span>AND bi.sgbstdn_program_1 = bip.sgbstdn_program_1</code><br/><code> <span>                      </span>AND bi.sfbetrm_ar_ind = bip.sfbetrm_ar_ind</code><br/><code> <span>                      </span>AND bi.sfbetrm_add_date = bip.sfbetrm_add_date</code><br/><code> <span>                      </span>AND bi.sfbetrm_ests_code = bip.sfbetrm_ests_code</code><br/><code> <span>                      </span>AND (bi.skbhins_enddate = bip.skbhins_enddate</code><br/><code> <span>                          </span>OR (bi.skbhins_enddate IS NULL AND bip.skbhins_enddate IS NULL))</code><br/><code> <span>                      </span>AND bi.shrdgmr_degs_code = bip.shrdgmr_degs_code</code><br/><code> <span>                      </span>AND (bi.shrdgmr_grad_date = bip.shrdgmr_grad_date</code><br/><code> <span>                          </span>OR (bi.shrdgmr_grad_date IS NULL AND bip.shrdgmr_grad_date IS NULL))) ;</code></p><p>(n.b. This is the logical 'inverse' of the previous query).</p><h3 id="TestingofMigratedScripts-Summary.2">Summary</h3><p>Testing of the <code>Banner4Import</code> class comprises determining that the <code>banner_import</code> table is populated with exactly them same data as that loaded by the <code>banner4import.pl</code> script.</p><h2 id="TestingofMigratedScripts-Banner4Person">Banner4Person</h2><h3 id="TestingofMigratedScripts-Overview.4">Overview</h3><p>The class <code>Banner4Person</code> is based on the Perl script <code>banner4person.pl</code>. The latter performs the following steps:</p><ol><li>Select students identified by a pre-defined MySQL query that selects data from the <code><span style="font-family: monospace;">banner_import</span></code>  table, the population of which is described above.</li><li>For each student returned by step #1, validate the details held (i.e. course, registration status, etc.) against data currently held in AccMan.</li><li>If the validation in step #2 is successful, update the student's details in AccMan (if the student already exists in AccMan) or create details of the new student in AccMan (if the student doesn't already exist in AccMan).</li></ol><h3 id="TestingofMigratedScripts-DeterminingBehaviourofPerlScript.3">Determining Behaviour of Perl Script</h3><p>In order to test the C# class <code>Banner4Person</code>, it will first be necessary to determine the behaviour of the existing Perl script. This will require a test AccMan database. The Perl script queries (reads from) the following AccMan tables:</p><p style="margin-left: 30.0px;"><code>banner_import</code></p><p style="margin-left: 30.0px;"><code>student_ests</code></p><p style="margin-left: 30.0px;"><code>person</code></p><p><span style="line-height: 1.4285715;">and writes to the following AccMan tables:</span></p><p style="margin-left: 30.0px;"><code>person</code></p><p style="margin-left: 30.0px;"><code>person_rejected_data</code></p><p style="margin-left: 30.0px;"><code>person_change</code></p><p>Since the Perl script creates appropriate records for a 'new' person / student updates the corresponding records for an 'existing' person / student, it is suggested that testing the behaviour of the script comprises:</p><ol><li>Creating a single record for a 'new' student in the <code>banner_import</code> table in AccMan.</li><li>Run the <code>banner4person.pl</code> Perl script.</li><li>Determine the contents of the person table in AccMan, perhaps querying the new records into a text file for later reference.</li><li>Change key fields of the <code>banner_import</code> record created in step #1.</li><li>Run the <code>banner4person.pl</code> Perl script again.</li><li>Determine the contents of the <code>person</code> and <code>person_change</code> tables in AccMan, perhaps querying the relevant records into a text file for later reference.</li></ol><p>It will also be necessary to identify a scenario in which a record is added to the <code>person_rejected_data</code> table. Some possible examples that would cause a record to be logged in this table are:</p><ul><li><code>SFBETRM_AR_IND</code> is a value other than 'Y', 'C' or 'N'.</li><li><code>SFBETRM_ESTS_CODE</code> is a value other than one of those defined in the <code>BannerEnrollmentStatus</code> enumeration.</li><li><code>SFBETRM_ADD_DATE</code> is null.</li></ul><p>(n.b. MySQL Workbench contains an option to copy the contents of a table row to the Windows Clipboard).</p><h3 id="TestingofMigratedScripts-DetermingBehaviourof.NETClass.3">Determing Behaviour of .NET Class</h3><p>The behaviour of the .NET class can be determined by repeating the steps listed in the previous section with a new test record in the AccMan <code>banner_import</code> table. It is advised to 'clear down' <code>banner_import</code> prior to executing these tests to ensure that only a single record is processed. The .NET process can be invoked by executing the <code style="line-height: 1.4285715;">ConsoleSchedulerService</code> project from the Visual Studio environment and entering the following on the console that appears:</p><p><code>  e:1504</code></p><p>As with the Perl script, the appropriate output will be written to the AccMan tables previously described.</p><h4 id="TestingofMigratedScripts-Test-Determiningallrowsgeneratedby.NETclassscriptarealsogeneratedbyPerlscript">Test - Determining all rows generated by .NET class script are also generated by Perl script</h4><p>Testing to ensure the .NET class <code>Banner4Person</code> behaves in the same manner as the Perl script <code>banner4person.pl</code> will require the output data, as saved above, to be compared. Suffice it to say, this will need to performed manually by the tester and cannot be prescribed here.</p><h2 id="TestingofMigratedScripts-NoShow">NoShow</h2><h3 id="TestingofMigratedScripts-Overview.5">Overview</h3><p>The class <code>NoShow</code> is based on the Perl script <code>noshow.pl</code>. The latter performs the following steps:</p><ol><li>Select students identified by a pre-defined MySQL query that selects data from the <code><span>person</span></code>  table, the population of which is described above. This query filters the dataset such that only records where the <code>source_code</code> field is 'S' and the <code>person_state</code> is 'expected' are returned. The fields selected from each person record are <code>personID</code> (the AccMan-generated unique identifier for each person), <code>PIDM</code> (the Banner-generated unique identifier for each person) and <code>stu_term</code>, the current term. </li><li>For each record identified in step #1, the following values are fetched directly from the Banner tables <code>SPRIDEN</code> and <code>SPBPERS</code> for the corresponding<code> PIDM</code>:  <code>SPRIDEN_ID</code>, <code>SPRIDEN_LAST_NAME</code>, <code>SPRIDEN_FIRST_NAME</code>, <code>SPRIDEN_MI</code>, <code>SPBPERS_BIRTH_DATE</code>, <code>SPBPERS_SEX</code>, and <code>SPBPERS_NAME_PREFIX</code>.</li><li>If step #2 does not find data in Banner, an error is logged. Otherwise, the following fields are fetched from the Banner table <code>SGBSTDN</code> for the latest effective term for which the corresponding PIDM has an entry: <code>SGBSTDN_TERM_CODE_EFF</code>, <code>SGBSTDN_STST_CODE</code>, <code>SGBSTDN_LEVL_CODE</code>, <code>SGBSTDN_STYP_CODE</code>, <code>SGBSTDN_DEGC_CODE_1</code>, <code>SGBSTDN_MAJR_CODE_1</code>, <code>SGBSTDN_BLCK_CODE</code>, <code>SGBSTDN_DEPT_CODE</code> and <code>SGBSTDN_PROGRAM_1</code>.</li><li>If step #3 successfully retrieves data from Banner, a subsequent query is executed against the Banner database to fetch the following fields from the <code>SFBETRM</code> table for the current PIDM and term, as identified in step #2: <code>SFBETRM_AR_IND</code>, <code>SFBETRM_ADD_DATE</code> and <code>SFBETRM_ESTS_CODE</code>.</li><li>If step #4 successfully retrieves data from Banner, a subsequent query against Banner is made to determine the latest <code>SKBHINS_ENDDATE</code> on the table <code>SKBHINS</code> for the current PIDM where <code>SKBHINS_ACTIVE_IND</code> equals 'Y'. Note that there may not be such a record on <code>SKBHINS</code>, in which case the date is considered to be null, which is not treated as an error. If step #4 has not identified a record, then the student's expected registration status (<code>SFBETRM_ESTS_CODE</code>) is assigned a default value based on the individual's student status (<code>SGBSTDN_STST_CODE</code>). The relationship between registration status and student status - and, additionally, 'person state' - is stored in the AccMan table <code>student_stst</code>  and is fetched from there.</li><li>The details retrieved in step #1 are now validated by the <code>parsePerson</code> sub-routine in the Perl script <code>studentPerson.pl</code>. This will not be described further, as it is beyond the scope of this test. Suffice it to say that it neither reads from nor writes to any database. If the student's roll number, which is derived from the numeric element of the <code>SPRIDEN_ID</code> value, is non-zero, then processing continues. Otherwise, an error is reported and the next record from step #1 is processed (i.e. steps #1 to #6 are repeated for the next record in sequence).</li><li>If step #6 has been successfully completed and it has not been necessary to fetch the next record, the script next determines if the student's expected registration status is set, which <em>may</em> have happened at step #5. If this is true, then the course details are now validated by the <code>parseCourse</code> sub-routine in the Perl script <code>studentPerson.pl</code>. This will not be described further, as it is beyond the scope of this test. Suffice it to say that it neither reads from nor writes to any database, as all validation is against hard-coded values or regular expression pattern searches.</li><li>A person who is determined to be 'expected' (see step #5) has a registration status of 'EL' (a.k.a. 'expected') set, otherwise the <code>parseRegistration</code> sub-routine determines the correct value. This will not be described further, as it is beyond the scope of this test. Suffice it to say that it neither reads from nor writes to any database, as all validation is against hard-coded values or regular expression pattern searches.</li><li>Finally, the updateStudentPerson sub-routine is invoked. This routine updates or inserts student data into the AccMan <code>person</code>, <code>person_change</code>, <code>person_add</code> and <code>person_rejected_data</code> tables. In addition, the AccMan tables <code>prog</code> and <code>extension</code> tables are queried. </li></ol><h3 id="TestingofMigratedScripts-DeterminingBehaviourofPerlScript.4">Determining Behaviour of Perl Script</h3><p>In order to test the C# class <code>NoShow</code>, it will first be necessary to determine the behaviour of the existing Perl script. This will require:</p><ol><li>A test AccMan database. The tables <code>person</code>, <code>prog</code> and extension are queried, while <code>person</code>, <code>person_change</code>, <code>person_add</code> and <code>person_rejected_data</code> are either inserted or updated. It is suggested that the data in the person table is initially updated to minimise the number of records that will be 'picked up' by the script. This involves updating all bar a select few records to a <code>source_code</code> other than 'S'; perhaps a value that is not already used, such as 'E' would suffice, as this is both a valid value for the column's check constraint and is not already present in the data.</li><li>A test Banner database. The contents of the above Banner tables will need to remain stable between the testing of the Perl script and C# class. It would probably be appropriate to use <code>DBANO1</code>, as the data held in Banner does not need to be synchronised with any other system. If this is an issue, due to firewall access issues preventing connections between 'test' and 'development' environments, it might be possible to use either <code>UBANO1</code> (Banner test) or <code>TBANFO</code> (Banner 'prod-fix').</li></ol><p>The behaviour of the Perl script can then be determined by:</p><ol><li>Running the script against the test databases.</li><li>Copying the final content of the AccMan <code>person</code>, <code>person_change</code>, <code>person_add</code> and <code>person_rejected_data</code> for the impacted rows to a series of temporary, working table. For example, a copy of <code>person</code> could,perhaps, be named <code>person_perl</code>. This can be achieved with the following SQL statement:</li></ol><p style="margin-left: 30.0px;"><code>CREATE TABLE person_perl</code><br/><code> AS</code><br/><code> SELECT *</code><br/><code>  FROM person</code><br/><code> WHERE source_code = 'S';</code></p><h3 id="TestingofMigratedScripts-DetermingBehaviourof.NETClass.4">Determing Behaviour of .NET Class</h3><p>The behaviour of the .NET class can be determined by repeating the steps listed in the previous section with a new test record in the AccMan <code>person</code> table. It is advised to ensure that the test record is for a different distinct individual from that used for testing the Perl script, but that all other values should remain the same. The .NET process can be invoked by executing the <code>ConsoleSchedulerService</code> project from the Visual Studio environment and entering the following on the console that appears:</p><p><code>  e:1507</code></p><p>As with the Perl script, the appropriate output will be written to the AccMan tables previously described.</p><h4 id="TestingofMigratedScripts-Test-Determiningallrowsgeneratedby.NETclassscriptarealsogeneratedbyPerlscript.1">Test - Determining all rows generated by .NET class script are also generated by Perl script</h4><p>Testing to ensure the .NET class <code>NoShow</code> behaves in the same manner as the Perl script <code>noshow.pl</code> will require the output data, as saved above, to be compared. Suffice it to say, this will need to performed manually by the tester and cannot be prescribed here.</p><h2 id="TestingofMigratedScripts-RestoreUFAA">RestoreUFAA</h2><h3 id="TestingofMigratedScripts-Overview.6">Overview</h3><p>The class <code>RestoreUFAA</code> is based on the Perl script <code>restoreUFAA.pl</code>. The latter performs the following steps:</p><ol><li>Fetch the <code>PIDM</code> and <code>program</code> values for every record in the AccMan <code>person</code> table where <code>source_code</code> = 'S' and <code>person_state</code> = 'left' for the current academic year.</li><li>For each record identified in step #1, check if there is an active (i.e. <code>SGBSTDN_STST_CODE</code> = 'AS') record in the Banner table <code>SGBSTDN</code> for the current PIDM and current (or subsequent) academic year but for a different programme of study. The columns <code>SGBSTDN_DEPT_CODE</code>, <code>SGBSTDN_LEVL_CODE</code> and <code>SGBSTDN_TERM_CODE_EFF</code> are fetched if this is the case.</li><li>If step #2 is 'true', then update the Banner table <code>SYRACCS</code>, setting <code>SYRACCS_ACCMAN_STATUS</code> to 'R' and <code>SYRACCS_ACTIVITY_DATE</code> to the current date and time for the PIDM, department code (<code>SYRACCS_DEPT_CODE</code>, from <code>SGBSTDN_DEPT_CODE</code>) and level code (<code>SYRACCS_LEVL_CODE</code>, from <code>SGBSTDN_LEVL_CODE</code>).</li></ol><h3 id="TestingofMigratedScripts-DeterminingBehaviourofPerlScript.5">Determining Behaviour of Perl Script</h3><p>In order to test the C# class <code>RestoreUFAA</code>, it will first be necessary to determine the behaviour of the existing Perl script. This will require:</p><ol><li>A test AccMan database, although only the contents of the <code>person</code> table are accessed but not changed. The current AccMan test database, <code>MAIL</code> on <code>UOS-T-RHEL-03</code>, might be appropriate for this test, as only the <code>person</code> table is impacted. It is proposed that a single record is given a <code>source_code</code> value of 'S' and all other records that currently have this status are temporarily updated to 'E', which is a valid but unused setting for this column.</li><li>A test Banner database. The contents of the above Banner tables will need to remain stable between the testing of the Perl script and C# class. It would probably be appropriate to use <code>DBANO1</code>, as the data held in Banner does not need to be synchronised with any other system. If this is an issue, due to firewall access issues preventing connections between 'test' and 'development' environments, it might be possible to use either <code>UBANO1</code> (Banner test) or <code>TBANFO</code> (Banner 'prod-fix'). It will be necessary to delete any existing record for the student under test and then run at least two tests to determine 'create' and 'update' behaviour.</li></ol><p>The behaviour of the Perl script can then be determined by:</p><ol><li>Examine the existing contents of the appropriate <code>SYRACCS</code> record on Banner.</li><li>Running the script against the test databases.</li><li>Examining the new values in the Banner <code>SYRACCS</code> table.</li></ol><h3 id="TestingofMigratedScripts-DetermingBehaviourof.NETClass.5">Determing Behaviour of .NET Class</h3><p>The .NET class now needs to be invoked against the same databases with the same initial data. This is currently performed in the Visual Studio environment by executing the <code>ConsoleSchedulerService</code> project and entering the following on the console that appears:</p><p><code>  e:1508</code></p><p>The behaviour of the .NET class can then be determined by:</p><ol><li>Examine the existing contents of the appropriate <code>SYRACCS</code> record on Banner.</li><li>Running the script against the test databases.</li><li>Examining the new values in the Banner <code>SYRACCS</code> table.</li></ol><h3 id="TestingofMigratedScripts-ComparingBehaviourofPerlScriptand.NETClass.3"><span style="font-size: 16.0px;line-height: 1.5625;">Comparing Behaviour of Perl Script and .NET Class</span></h3><p>The 'before' and 'after' values of the <code>SYRACCS</code> record now need to be compared for each scenario:</p><ol><li>No existing <code>SYRACCS</code> record in Banner for person record under test.</li><li>Existing record in <code>SYRACCS</code>in Banner for person record under test.</li></ol><h2 id="TestingofMigratedScripts-StudentAutoState">StudentAutoState</h2><h3 id="TestingofMigratedScripts-Overview.7">Overview</h3><p>The class <code>StudentAutoState</code> is based on the Perl script <code>studentautostate.pl</code>. The latter performs the following steps:</p><p> </p>
                    </div>

                    
                                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="comments" class="pageSectionTitle">Comments:</h2>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-17170620"></a>
                                    <font class="smallfont"><p>This level of detail will be a good template for others when setting out the testing for the rest of the .NET scripts</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ujs038 at Dec 03, 2014 13:56
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    </div>
                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Mar 29, 2021 11:13</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
