<!DOCTYPE html>
<html>
    <head>
        <title>Accman : AccMan Data Snapshot Visualisations Development Guide</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Accman</a></span>
                            </li>
                                                    <li>
                                <span><a href="Accman-Home_16384043.html">Accman Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Documentation_16384018.html">Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="Development-Guide_34177079.html">Development Guide</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Accman : AccMan Data Snapshot Visualisations Development Guide
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Unknown User (aaa45816)</span>, last modified on Feb 16, 2017
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="WordSection1"><p><div class="aui-message aui-message-error"><p class="title"><strong>Error rendering macro 'toc'</strong></p><p>null</p></div></p></div><div class="WordSection2"><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-Introduction">Introduction</h2><p>The data snapshot visualisations component is part of the Acc Man Front End Web Application.</p><p>This guide is intended for the Software Developer working on the Acc Man Front End Web Application.</p><p>Acc Man Front End source code:</p><div class="table-wrap"><table class="confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p>Acc Man Project source:</p></td><td class="confluenceTd"><p>Bit Bucket (stash):</p><p><a href="https://aaa45816@stash.salford.ac.uk:8447/scm/ac/accman.net.git" class="external-link" rel="nofollow">https://aaa45816@stash.salford.ac.uk:8447/scm/ac/accman.net.git</a></p></td></tr><tr><td class="confluenceTd"><p>Branch</p></td><td class="confluenceTd"><p>feature/ARF-404-capture-account-person-status-data</p></td></tr></tbody></table></div><p> </p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-Pre-Requisites">Pre-Requisites</h2><p>Visual Studio 2015</p><p>.NET Framework 4.5.2</p><p>MySQL AccMan database.</p><p>jQuery 1.4.2</p><p>jQuery UI 1.8.4</p><p>ChartJS</p><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-Databaseschema">Database schema</h1><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-Tables">Tables</h2><div class="table-wrap"><table class="confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p><strong>Table</strong></p></td><td class="confluenceTd"><p><strong>Description</strong></p></td></tr><tr><td class="confluenceTd"><p><strong>snapshot_types</strong></p></td><td class="confluenceTd"><p>A list of unique types of snapshot e.g. Person account states</p></td></tr><tr><td class="confluenceTd"><p><strong>data_snapshot</strong></p></td><td class="confluenceTd"><p>Unique snapshot instances taken on each scheduled capture.</p></td></tr><tr><td class="confluenceTd"><p><strong>Account_statuses</strong></p></td><td class="confluenceTd"><p>A list of unique states for an account.</p></td></tr><tr><td class="confluenceTd"><p><strong>Person_statuses</strong></p></td><td class="confluenceTd"><p>A list of unique states for a person.</p></td></tr><tr><td class="confluenceTd"><p><strong>Account_person_state_snapshot_entry</strong></p></td><td class="confluenceTd"><p>Snapshot data for account vs person statuses on each account / person in the AccMan database on that snapshot instance.</p></td></tr></tbody></table></div><p> </p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-TableColumns">Table Columns</h2><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="8" class="confluenceTd"><p><strong>Table: snapshot_types</strong></p></td></tr><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Type</p></td><td class="confluenceTd"><p>Size</p></td><td class="confluenceTd"><p>Primary Key</p></td><td class="confluenceTd"><p>Auto Increment</p></td><td class="confluenceTd"><p>Not Null</p></td><td class="confluenceTd"><p>Default/Expression</p></td><td class="confluenceTd"><p>Unique</p></td></tr><tr><td class="confluenceTd"><p>Id</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>Type</p></td><td class="confluenceTd"><p>Varchar</p></td><td class="confluenceTd"><p>30</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>‘’</p></td><td class="confluenceTd"><p>Yes</p></td></tr><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Varchar</p></td><td class="confluenceTd"><p>45</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>‘’</p></td><td class="confluenceTd"><p>Yes</p></td></tr></tbody></table></div><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="8" class="confluenceTd"><p>Table: data_snapshot</p></td></tr><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Type</p></td><td class="confluenceTd"><p>Size</p></td><td class="confluenceTd"><p>Primary Key</p></td><td class="confluenceTd"><p>Auto Increment</p></td><td class="confluenceTd"><p>Not Null</p></td><td class="confluenceTd"><p>Default/Expression</p></td><td class="confluenceTd"><p>Unique</p></td></tr><tr><td class="confluenceTd"><p>Id</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>Snapshot_type_id</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>Snapshot_datetime</p></td><td class="confluenceTd"><p>datetime</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Current_timestamp</p></td><td class="confluenceTd"><p> </p></td></tr></tbody></table></div><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="8" class="confluenceTd"><p><strong>Table: </strong>account_statuses</p></td></tr><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Type</p></td><td class="confluenceTd"><p>Size</p></td><td class="confluenceTd"><p>Primary Key</p></td><td class="confluenceTd"><p>Auto Increment</p></td><td class="confluenceTd"><p>Not Null</p></td><td class="confluenceTd"><p>Default/Expression</p></td><td class="confluenceTd"><p>Unique</p></td></tr><tr><td class="confluenceTd"><p>Id</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>Account_status</p></td><td class="confluenceTd"><p>Varchar</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>‘’</p></td><td class="confluenceTd"><p>Yes</p></td></tr></tbody></table></div><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="8" class="confluenceTd"><p><strong>Table: </strong>person_statuses</p></td></tr><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Type</p></td><td class="confluenceTd"><p>Size</p></td><td class="confluenceTd"><p>Primary Key</p></td><td class="confluenceTd"><p>Auto Increment</p></td><td class="confluenceTd"><p>Not Null</p></td><td class="confluenceTd"><p>Default/Expression</p></td><td class="confluenceTd"><p>Unique</p></td></tr><tr><td class="confluenceTd"><p>Id</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>Person_status</p></td><td class="confluenceTd"><p>Varchar</p></td><td class="confluenceTd"><p>10</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>‘’</p></td><td class="confluenceTd"><p>Yes</p></td></tr></tbody></table></div><p> </p><div class="table-wrap"><table class="confluenceTable"><colgroup><col/><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><td colspan="8" class="confluenceTd"><p><strong>Table: </strong>Account_person_state_snapshot_entry</p></td></tr><tr><td class="confluenceTd"><p>Name</p></td><td class="confluenceTd"><p>Type</p></td><td class="confluenceTd"><p>Size</p></td><td class="confluenceTd"><p>Primary Key</p></td><td class="confluenceTd"><p>Auto Increment</p></td><td class="confluenceTd"><p>Not Null</p></td><td class="confluenceTd"><p>Default/Expression</p></td><td class="confluenceTd"><p>Unique</p></td></tr><tr><td class="confluenceTd"><p>Id</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>Snapshot_id</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>Account_status_id</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>Person_status_id</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr><tr><td class="confluenceTd"><p>Count</p></td><td class="confluenceTd"><p>Mediumint</p></td><td class="confluenceTd"><p>9</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Yes</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr></tbody></table></div></div><p><br/></p><div class="WordSection3"><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-ClientSideUserControls/PartialViews">Client Side User Controls / Partial Views</h1><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-EntrypointtoSnapshotswebpage">Entry point to Snapshots web page</h2><p>The user is able to access the snapshot visualisations from the AccMan main menu &gt; Health Checks &gt; System Status.</p><p>On the System Status page, the Snapshots tab allows the user to see the visualisations.</p><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-JavaScriptComponents">JavaScript Components</h1><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-SnapshotJavaScriptfilestructure">Snapshot JavaScript file structure</h2><p>In the project AccMan root, the Scripts folder contains the following files used for snapshot data visualisation:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" width="220" src="attachments/34177053/34177059.png" data-image-src="attachments/34177053/34177059.png" data-unresolved-comment-count="0" data-linked-resource-id="34177059" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2017-2-16_16-43-44.png" data-base-url="https://confluence.salford.ac.uk:8444/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="34177053" data-linked-resource-container-version="3"></span></p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-ObjectModels">Object Models</h2><p>The client side Snapshots functionality relies on some JavaScript objects which are used to defined parameters for a visualisation and the snapshot visualisation itself.</p><p>These are transmitted as JSON to the controller actions to generate the required snapshot data model.</p><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-snapshot-filter.js:">snapshot-filter.js:</h3><p>A snapshotFilter represents a user selection in the snapshot parameters.</p><p>The functional initialiser of a snapshotFilter object sets default values to the properties of the snapshotFilter.</p><p>The FilterGroupName serves purpose for both the client side control id/name and for the field name when posted to the controller action.</p><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-snapshot-model.js:">snapshot-model.js:</h3><p>A snapshotModel represents the snapshot type and it’s filters.</p><p>The controller action SystemController.GetSnapshotData expects this model structure as its parameter. The simple object snapshotModel is the structure which specifies the snapshot type id and the filters selected by the user.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-UIFunctions">UI Functions</h2><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-snapshots-control-ui.js:">snapshots-control-ui.js:</h3><p>Functions in this file should only manipulate ui controls for the snapshots components.</p><p><strong>Page load/ready</strong></p><p><em>Performs event binding to page elements.</em></p><p>Page load initialisation is handled in this script using the jQuery document ready shorthand. Within this function, the following happens:</p><ol><li>The snapshot drop down list is bound to change event to retrieve the parameter controls ui.</li><li>The view-snapshot-button button is bound to on click event to call the LoadSnapshot function.</li></ol><p><strong>SetParameterControls(html)</strong></p><p>Renders UI controls to allow the user to select snapshot parameters.</p><p>This function constructs and appends html to the snapshot user control page. This will serve as the container for the snapshot parameters user controls.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-CoreFunctions">Core Functions</h2><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-snapshots-core.js:">snapshots-core.js:</h3><p><strong>GetSnapshotParametersControls(callback, snapshotId)</strong></p><p>Retrieves UI controls to allow the user to select snapshot parameters.</p><p>This calls the snapshot controller action GetSnapshotParametersControls in order to obtain the html for the snapshot visualisation parameters. The user is then able to select parameters for this specific snapshot type.</p><p>In order to maintain separation between ui and core logic, the success function of this methods’ internal ajax call fires the callback function. It is expected by design this callback does something with the html, in this case it just renders it inside the placeholder div ‘snapshotParameters’.</p><p><strong>GetUserFilters()</strong></p><p>Collects the users’ snapshot parameter selections as a snapshotFilter array.</p><p>The snapshot parameters controls are rendered with custom data-* attributes.</p><p>These attributes are</p><p>-          data-snapshotelement=param</p><p>-          data-paramtype=datetime</p><p>Various other ones may be added/used as required, noting not to conflict with any other JavaScript framework/component data-attributes.</p><p>The filters are collected by first checking for checkboxes with the data attribute ‘data-snapshotelement’ with value: ‘param’.</p><p>Then the text boxes are collected and converted into the same snapshotFilter model as the checkboxes.</p><p><strong>LoadSnapshot()</strong></p><p>Collects user selected parameters/filters and retrieves the chart data from the SystemController.</p><p>GetUserFilters is called and then passed to the SystemController as JSON parameter. The resulting chart data is passed into the LoadChart(data) function.</p><p><strong>LoadChart(chartData)</strong></p><p>Parses the chart data to construct a charts labels, data points and axis values.</p><p>With the chart data received, this function generates a chart model ‘lineChart’ with the labels to display as a parameter.</p><p>Then for each chart label, the data points, label caption and cosmetic values are passed to the addLineToChart function.</p><p><strong>lineChart(labels)</strong></p><p>A ChartJS object defining the third party components required config model for a chart.</p><p>This function returns a chart instance as a config object with property names required by ChartJS.</p><p><strong>addLineToChart(chartConfig, lineDataPoints, lineColor, lineLabel)</strong></p><p>Adds a line to the line chart object config by setting XYDataPoint data and labels.</p><p>This function essentially populates the ChartJS configs’ data.datasets property by adding each line’s data, label and colour.</p></div><p><br/></p><div class="WordSection4"><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-ProcessFlow:Capturingsnapshotdata">Process Flow: Capturing snapshot data</h1><p>This process() is called within each ConsoleSchedulerService schedule trigger event.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="600" src="attachments/34177053/34177058.png" data-image-src="attachments/34177053/34177058.png" data-unresolved-comment-count="0" data-linked-resource-id="34177058" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2017-2-16_16-43-1.png" data-base-url="https://confluence.salford.ac.uk:8444/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="34177053" data-linked-resource-container-version="3"></span></p></div><p><br/></p><div class="WordSection5"><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-ProcessFlow:LoadingaChart">Process Flow: Loading a Chart</h1><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="600" src="attachments/34177053/34177057.png" data-image-src="attachments/34177053/34177057.png" data-unresolved-comment-count="0" data-linked-resource-id="34177057" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2017-2-16_16-42-19.png" data-base-url="https://confluence.salford.ac.uk:8444/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="34177053" data-linked-resource-container-version="3"></span></p></div><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-MVCControllerEvents">MVC Controller Events</h1><p>The SystemController is responsible for serving the initial page to load the Snapshot data visualisations.</p><p>The sequence of actions is as follows:</p><ol><li>.NET MVC first receives the request to serve the System HealthChecks view. Within the HealthChecks view, the Snapshots link anchor control allows the user to load the snapshots controls.</li><li>The snapshots controls are delivered from the Snapshots PartialView action.</li><li>After the user selects the Snapshot type the System controller then returns the GetSnapshotParametersControls PartialViewResult object “~/views/system/snapshot/parameters.ascx”. This partial view renders the user selectable filters for the selected snapshot type.</li><li>The System controller then handles the request to load a visualisation by calling the GetSnapshotData JsonResult method/action. This calls the relevant delegate snapshot data implementation and returns the visualisation data as JSON.</li></ol><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-DataAccessObjects">Data Access Objects</h1><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-SnapshotDAO">SnapshotDAO</h2><p>The purpose of the SnapshotDAO is to interact with the Snapshot data tables.</p><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-GetSnapshotTypes">GetSnapshotTypes</h3><p>To get the Snapshot types available as stored in the database, call GetSnapshotTypes. This will return list of type SnapshotType.</p><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-GetPersonAndAccountStatesSnapshot">GetPersonAndAccountStatesSnapshot</h3><p>When a snapshot is required this method will call a query on the Acc Man database person and account tables summarising the person to account state combinations currently held. The resulting object is list of type PersonAccountState.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-PersonAccountStateSnapshotDAO">PersonAccountStateSnapshotDAO</h2><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-GetPersonAndAccountStatesSnapshot.1">GetPersonAndAccountStatesSnapshot</h3><p>This method is responsible for grouping Person and Account state combinations by types and returning a list of type PersonAccountState. The list represents the person state, account state and count of occurrences in the Acc Man database at the time of execution. This data is intended for the insertion into the account_person_state_snapshot_entry database table.</p><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-SnapshotSpecificTransactionTypeDefinitions">Snapshot Specific TransactionType Definitions</h1><p>In <a href="http://uk.ac" class="external-link" rel="nofollow">uk.ac</a>.salford.accman.Models.Enumerations.TransactionType enumeration, add a new definition to represent the new snapshot type being implemented. These definitions are required to allow ConsoleSchedulerService to process the corresponding snapshot Quartz job.</p><p>Current snapshot specific TransactionType definitions:</p><p>135 - CAPTURE_ACCOUNT_AND_PERSON_STATUS_SNAPSHOTS</p><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-TransactionServiceProcessImplementations">TransactionServiceProcess Implementations</h1><p>These implementations are so that console scheduler service can correctly load the class configured in the Quartz job to query the snapshot data and to write it to the data_snapshot and specific table(s).</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-SnapshotProcessorBase">SnapshotProcessorBase</h2><p>Use this class to derive a new snapshot specific TransactionServiceProcess type. An example is CaptureAccountAndPersonStatusSnapshots.cs.</p><p>This base class offers generic methods to create a data_snapshot record and to clean up too in case of exceptions.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-CaptureAccountAndPersonStatusSnapshots">CaptureAccountAndPersonStatusSnapshots</h2><p>The account and person state summary snapshot data is processed in this class. Specifically the process override handles the creation of the data_snapshot record and the specific entries in account_person_state_snapshot_entry.</p><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-DataModels">Data Models</h1><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-SnapshotType">SnapshotType</h2><p>A SnapshotType</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-DataSnapshot">DataSnapshot</h2><p>A DataSnapshot defines the snapshot id, the type and when it was captured. This reflects the data table columns of data_snapshot.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-PersonAccountState">PersonAccountState</h2><p>This is related to the snapshot data capture of the person and account state. It defines the snapshot date time and the account and person state as well as its total count. This model reflects the data table columns of account_person_state_snapshot_entry.</p><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-BusinessModels">Business Models</h1><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-ParameterTypes">ParameterTypes</h2><p>This model class defines the code interface and implementations of the type of visual controls that a user can see for a specific snapshot visualisation. These are generally serialised to JSON for client side code usage.</p><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-SnapshotParameter">SnapshotParameter</h3><p>Any parameter on the UI which can be rendered and used like or as a text box input/ free text.</p><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-DateTimeSnapshotParameter">DateTimeSnapshotParameter</h3><p>Child class defining itself as a date time specific field for user entry of a date.</p><h3 id="AccManDataSnapshotVisualisationsDevelopmentGuide-MultiChoiceSnapshotParameter">MultiChoiceSnapshotParameter</h3><p>Exposes a collection property ‘Options’ to allow user to select from a choice of values for the snapshot parameter.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-PersonAccountStateParameters">PersonAccountStateParameters</h2><p>Simple class defining a list of type ISnapshotParameter as ‘Parameters’. An instance of this class can contain any type of ISnapshotParameter type object in ‘Parameters’ thus allowing many different parameters UI control types on the client side.</p><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-ClientViewModels">Client View Models</h1><p>After the business logic processes service requests, the client view models are constructed and populated to meet the structure expected by client side logic. The following view models are required and used by the front end controls.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-DataPoint">DataPoint</h2><p>A DataPoint class object specifies the intersection of two axis x and y for the purpose of visual charting.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-ChartLine">ChartLine</h2><p>A ChartLine object is a collection of DataPoint objects along with any visual configuration e.g. colour, label.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-Chart">Chart</h2><p>A Chart object is a collection of the data items e.g. ChartLine and XLabels; a collection of labels to use to depict the values of the X-axis items.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-SnapshotsViewModel">SnapshotsViewModel</h2><p>A simple collection of SnapshotTypes defined as the SnapshotTypeId and its string text representation e.g. [1,”PersonAccountStates”].</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-SnapshotFilter">SnapshotFilter</h2><p>This is the definition of a filter for which the snapshot should apply as a data filter on the snapshot data.</p><h2 id="AccManDataSnapshotVisualisationsDevelopmentGuide-SnapshotUserModel">SnapshotUserModel</h2><p>A collection of filters for a snapshot data set and the associated Snapshot Id.</p><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-CreatingaDataSnapshot">Creating a Data Snapshot</h1><ol><li>Create a new TransactionType definition.</li><li>Implement a TransactionServiceProcess class to collect the data similar to CaptureAccountAndPersonStatusSnapshots.</li><li>In the TransactionServiceProcess implementation override the Init method to set the TransactionType to the new enum definition.</li><li>In the Quartz config file, add a new job configuration to enable ConsoleSchedulerService to create the snapshots.</li><li>Override the Process method.</li><li>Implement a snapshot specific method in SnapshotDAO similar to GetPersonAndAccountStateSnapshot.</li><li>Back in the TransactionServiceProcess implementation, in the Process override, call this new SnapshotDAO method specific to this snapshot type. This will return the data to capture.</li><li>Handle data_snapshot parent record creation and clean up in case failure.</li><li>Write to the data_snapshot table.</li><li>Write the snapshot data returned from the specific SnapshotDAO method snapshot specific database table.</li></ol><h1 id="AccManDataSnapshotVisualisationsDevelopmentGuide-ConfiguringtheSolutionsforRelease">Configuring the Solutions for Release</h1><p>Both .NET Code Library (AccMan Back End) and AccMan.Net Front End will require building and releasing for any new visualisations.</p><ol><li>Ensure the Quartz config file contains the new configuration for the new snapshot capture TransactionServiceProcess implementation.</li><li>Build the .NET Code Library solution</li><li>Build the AccMan.NET solution</li><li>Set the Web.Config of AccMan.NET to log the messages accordingly as required.</li><li>Set the App.Config of ConsoleSchedulerService app to log the messages accordingly as required and also for the new TransactionType definition. (message log path set in quartz config for the specific TransactionType).</li></ol>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/34177053/34177054.docx">Acc man data snapshot visualisations.docx</a> (application/vnd.openxmlformats-officedocument.wordprocessingml.document)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/34177053/34177057.png">image2017-2-16_16-42-19.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/34177053/34177058.png">image2017-2-16_16-43-1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/34177053/34177059.png">image2017-2-16_16-43-44.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Mar 29, 2021 10:56</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
